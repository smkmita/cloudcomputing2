WAJIB BUKA PORT DI GRUP KEMANAN
- Tambahkan aturan masuk utk port PORT 9090 & 9100 izinkan  semua ip

LAKUKAN INI DI SERVER WEB YG AKAN DIMONITORING
====INSTALLASI NODE EXPORTER DI SERVER TARGET YG AKAN DIMONITORING======
Sebelum melakukan installasi node exporter, kita akan mengunduh package binary/node exporter dahulu. Gunakan perintah berikut:
# sudo apt update -y
# wget https://github.com/prometheus/node_exporter/releases/download/v1.7.0/node_exporter-1.7.0.linux-amd64.tar.gz

Selanjutnya, ekstrak paket node exporter dan pindahkan pada direktori /usr/local/bin.
# tar xvf node_exporter-*.tar.gz
# cd node_exporter-1.7.0.linux-amd64
# sudo cp node_exporter /usr/local/bin

Apabila file node exporter telah dipindahkan ke usr/bin, maka kita perlu melakukan pembuatan user node exporter dan melakukan set binary mode ke user node exporter
# sudo useradd --no-create-home --shell /bin/false node_exporter
# sudo chown node_exporter:node_exporter /usr/local/bin/node_exporter

Selanjutnya, buat file service systemd node exporter.
# sudo nano /etc/systemd/system/node_exporter.service

Isi konfigurasi file berikut kedalam file node exporter yang dibuat sebelumya.
------------------copas-skrip-ini--------------
Description=Node Exporter
Wants=network-online.target
After=network-online.target

[Service]
User=node_exporter
Group=node_exporter
Type=simple
ExecStart=/usr/local/bin/node_exporter
Restart=always
RestartSec=3
[Install]

WantedBy=multi-user.target
------------------copas-skrip-ini--------------

Lalu simpan dan keluar dari nano editor.

Untuk memulai node exporter, Anda perlu menjalankan daemon-reload dan mengaktifkan pada systemctl sebagai berikut:
# sudo systemctl daemon-reload
# sudo systemctl enable node_exporter
# sudo systemctl start node_exporter

Sampai langkah ini, proses installasi node exporter telah selesai dilakukan. Untuk memastikan node exporter telah berjalan, kita dapat mengakses halaman website  http://ip_server:9100/metrics
JANGAN LUPA BUKA PORT 9100

INSTALASI PROMETHEUS
Pada awal installasi prometheus, hal yang perlu dilakukan adalah melakukan pembuatan user dan group untuk mencegah adanya unauthorized access, untuk user akan diberikan nama prometheus.
# sudo groupadd --system prometheus
# sudo useradd -s /sbin/nologin --system -g prometheus prometheus

Selanjutnya, buat direktori untuk menyimpan file konfigurasi dari prometeus, yaitu pada /etc dan pada /var/lib.
# sudo mkdir /etc/prometheus
# sudo mkdir /var/lib/prometheus
# sudo mkdir /etc/prometheus/consoles

Setelah lokasi folder prometheus dibuat, selanjutnya akan melakukan download package prometheus menggunakan wget:
# wget https://github.com/prometheus/prometheus/releases/download/v2.43.0/prometheus-2.43.0.linux-amd64.tar.gz

Setelah proses download selesai, langkah selanjutnya adalah melakukan extract package dan memindahkan ke direktori yang dibuat sebelumya, yaitu /usr/local/. Pastikan ownership telah disesuaikan menjadi Prometheus
# tar vxf prometheus*.tar.gz
# cd prometheus-2.43.0.linux-amd64
# sudo mv prometheus /usr/local/bin
# sudo mv promtool /usr/local/bin
# sudo chown prometheus:prometheus /usr/local/bin/prometheus
# sudo chown prometheus:prometheus /usr/local/bin/promtool

Pindahkan konfigurasi file prometheus dan sesuaikan permission folder/filenya.
# sudo mv consoles /etc/prometheus
# sudo mv console_libraries /etc/prometheus
# sudo mv prometheus.yml /etc/prometheus
# sudo chown prometheus:prometheus /etc/prometheus
# sudo chown -R prometheus:prometheus /etc/prometheus/consoles
# sudo chown -R prometheus:prometheus /etc/prometheus/console_libraries
# sudo chown -R prometheus:prometheus /var/lib/prometheus

File konfigurasi prometheus terdapat pada /etc/prometheus/prometheus.yml, kita perlu melakukan konfigurasi pada file prometheus agar prometheus dapat terhubung dengan node exporter dan grafana.
# sudo nano /etc/prometheus/prometheus.yml

Lalu, Tambahkan job di akhir baris skrip :
------------------copas-skrip-ini--------------
- job_name: "nodeexporter"
  static_configs:
      - targets: ["localhost:9100"]
------------------copas-skrip-ini--------------

Langkah selanjutnya adalah membuat systemd untuk prometheus agar dapat berjalan pada VPS, buat file baru pada /etc/systemd/system/prometheus.service

# sudo nano /etc/systemd/system/prometheus.service

Lalu, isi dengan konfigurasi prometeus berikut ini :
------------------copas-skrip-ini--------------
[Unit]
Description=Prometheus
Wants=network-online.target
After=network-online.target

[Service]
User=prometheus
Group=prometheus
Type=simple

ExecStart=/usr/local/bin/prometheus \
   --config.file /etc/prometheus/prometheus.yml \
   --storage.tsdb.path /var/lib/prometheus/ \
   --web.console.templates=/etc/prometheus/consoles \
   --web.console.libraries=/etc/prometheus/console_libraries

[Install]
WantedBy=multi-user.target
------------------copas-skrip-ini--------------

Apabila file systemd prometheus telah dibuat, langkah selanjutnya adalah mengaktifkan service prometeus melalui systemd.
# sudo systemctl daemon-reload
# sudo systemctl enable prometheus
# sudo systemctl start prometheus

Installasi Prometheus telah selesai, kita dapat mengakses halaman prometeus melalui browser http://ip_server:9090/graph
Selanjutnya login ke server monitoring utk menginstall Grafana.
JANGAN LUPA BUKA PORT 9090


=====LAKUKAN INI DI SERVER MONITORING BUKAN DI SERVER YG DIMONITORING========
====INSTALASI GRAFANA DI SERVER MONITORING=====

WAJIB BUKA PORT 3000 di Grup Keamanan

Installasi Grafana
Grafana digunakan sebagai visualisasi dashboard, data yang dikumpulkan dan dianalisa pada prometeus akan ditampikan berupa grafik, bar, pie, dan tampilan menarik lainnya yang bertujuan untuk mempermudah pembacaan grafik.

Untuk installasi Grafana, tambahkan terlebih dahulu repository dari official Grafana
Buat folder ini :
#sudo mkdir /etc/yum.repos.d

Isi file repository dengan repository grafana sebagai berikut: 
#sudo nano /etc/yum.repos.d/grafana.repo
Copas skrip ini di file tersebut, lalu simpan :
------------------copas-skrip-dibawah-ini--------------
[grafana]
name=grafana
baseurl=https://packages.grafana.com/oss/rpm
repo_gpgcheck=1
enabled=1
gpgcheck=1
gpgkey=https://packages.grafana.com/gpg.key
sslverify=1
sslcacert=/etc/pki/tls/certs/ca-bundle.crt
----------------------------------------------------------
Lalu simpan dan keluar dari text editor nano.

Setelah menambahkan repository grafana, kita perlu menambahkan GPG key dari grafana:
#sudo mkdir -p /etc/apt/keyrings/
#wget -q -O - https://apt.grafana.com/gpg.key | gpg --dearmor | sudo tee /etc/apt/keyrings/grafana.gpg > /dev/null

Mulai proses penambahan repository:
#echo "deb [signed-by=/etc/apt/keyrings/grafana.gpg] https://apt.grafana.com stable main" | sudo tee -a /etc/apt/sources.list.d/grafana.list

#sudo apt update

#sudo apt install grafana

Aktifkan service Grafana:
#sudo systemctl start grafana-server

Enable service:
#sudo systemctl enable grafana-server

Cek status :
#sudo systemctl status grafana-server

FINISH: coba akses di browser = http://ip_address:3000
user: admin
pass: admin

JANGAN LUPA BUKA PORT 3000

[Menambahkan Server ke Sistem Monitoring]
Setelah proses installasi semua tools selesai, langkah yang perlu dilakukan selanjutnya adalah menambahkan VPS yang sudah terinstall node exporter ke dashboard grafana.

Untuk menambahkan node exporter, masuk ke menu data source pada grafana seperti gambar berikut:
-> klik menu Home, Connection, Datasource, pilih Prometheus core
Isi konfigurasi pada prometheus dengan http://localhost:9090 apabila server grafana dan prometheus dalam 1 node server yang sama, lalu save dan exit.

Selanjutnya, kita dapat membuat dashboard secara mandiri menggunakan analisis query prometheus,atau dapat mengimport dashboard tampilan yang sudah jadi/disediakan oleh grafana.

Klik Dashboards, New, New Dasboard, Pilih Import a dashboar, lalu isikan kode 1860, klik load



